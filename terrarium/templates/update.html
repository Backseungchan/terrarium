<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<title>ğŸŒ¿Terrarium</title>
	<!-- og íƒœê·¸-->
	<meta property="og:title" content="ğŸŒ¿Terrarium - í…Œë¼ë¦¬ì›€">
	<meta property="og:image" content="/og_image.jpg">
	<meta property="og:description" content="ì˜ í‚¤ìš´ ë°˜ë ¤ì‹ë¬¼ ì—´ ë°˜ë ¤ë™ë¬¼ ì•ˆë¶€ëŸ½ë‹¤? ë‚´ê°€ í‚¤ìš´ ì‹ë¬¼ë¡œ ì¬í…Œí¬ ê¹Œì§€ ëª¨ë“  ê±´ í…Œë¼ë¦¬ì›€ì—ì„œ~">
	<!-- jQuery ë¡œë“œ -->
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<!-- ë¶€íŠ¸ìŠ¤íŠ¸ë© CSS ë¡œë“œ -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
		integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
	<!-- ë¶€íŠ¸ìŠ¤íŠ¸ë© Javascript(ì• ë‹ˆë©”ì´ì…˜ ë“±ì— ì‚¬ìš©ë¨) ë¡œë“œ -->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2"
		crossorigin="anonymous"></script>
	<!-- íŒŒì¼ ì—…ë¡œë“œ ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
	<script src="https://cdn.jsdelivr.net/npm/bs-custom-file-input/dist/bs-custom-file-input.js"></script>
	<!-- í…Œë§ˆ CSS ë¡œë“œ(ì§€ê¸ˆì€ í°íŠ¸ë§Œ ìˆëŠ” ìƒíƒœ, theme.css ìˆ˜ì • ì‹œ ì£¼ì„ë„ ìˆ˜ì •í•´ì£¼ì„¸ìš”) -->
	<link rel="stylesheet" href="../static/theme.css">
	<link rel="stylesheet" href="../static/upload.css">
	<script>
		$(document).ready(function () {
			setUp(1)
		})

		//ê¸°ì¡´ì˜ ë‚´ìš© ì±„ì›Œë‘ê¸°
		function setUp(postnum) {
			$.ajax({
				type: "GET",
				url: "/detail",
				data: { postnum: postnum },
				success: function (response) {
					let post = response['post']

					let title = post[0]['title']
					let pic = post[0]['pic']
					let contents = post[0]['contents']


					document.querySelector("#title").setAttribute("value", title)
					$(".custom-file-label")[0].innerHTML = pic
					document.querySelector("#thumbnail").setAttribute("src", "../static/" + pic);
					$("#contents").val(contents)
				}
			})
		}

		// ì´ë¯¸ì§€ ì—…ë¡œë“œì‹œ ì¸ë„¤ì¼ í˜•ì‹ìœ¼ë¡œ ë¹„ì³ì¤Œ
		function setThumbnail(event) {
			bsCustomFileInput.init()
			var reader = new FileReader()

			reader.onload = function (event) {
				document.querySelector("#thumbnail").setAttribute("src", event.target.result);
			};
			reader.readAsDataURL(event.target.files[0]);
		}

		// ì·¨ì†Œ ë²„íŠ¼
		function cancel() {
			window.location.href("#")
		}

		// ì™„ë£Œ ë²„íŠ¼
		function fixing(postnum) {
			let title = $('#title').val()
			let contents = $('#contents').val()
			let pic = $('#pic')[0].files[0]

			console.log(pic)

			let form_data = new FormData()
			form_data.append("postnum", postnum)
			form_data.append("title", title)
			form_data.append("pic", pic)
			form_data.append("contents", contents)

			console.log(form_data)

			$.ajax({
				type: "POST",
				url: "/update",
				data: form_data,
				cache: false,
				contentType: false,
				processData: false,
				success: function (response) {
					alert(response["msg"])
					window.location.href('#') // ì™„ë£Œë˜ë©´ ë¦¬ìŠ¤íŠ¸ í•­ëª©ìœ¼ë¡œ ì—°ê²°
				}
			});
		}
	</script>
</head>

<body>
	<div class="header">
		<h1>ê²Œì‹œê¸€ ìˆ˜ì •</h1>
	</div>
	<div class="wrap">
		<div class="jumbotron jumbotron-fluid main">
			<div class="container">
				<div class="posting-box">
					<div class="form-group">
						<input type="text" class="form-control" id="title" placeholder="ê²Œì‹œë¬¼ ì œëª©">
					</div>
					<div class="custom-file">
						<input type="file" onchange="setThumbnail(event)" class="custom-file-input" id="pic">
						<label class="custom-file-label" for="pic">ì‚¬ì§„ ì„ íƒ</label>
						<div id="thumbnailBox">
							<img src="" id="thumbnail">
						</div>
					</div>
					<div class="form-group">
						<textarea class="form-control" id="contents" rows="5" placeholder="ê²Œì‹œë¬¼ ë‚´ìš©">
						</textarea>
					</div>
					<div class="button-box">
						<button onclick="cancel()" type="button" class="btn btn-primary">ì·¨ì†Œ</button>
						<button onclick="fixing(1)" type="button" class="btn btn-danger">ì™„ë£Œ</button>
					</div>
				</div>
			</div>
		</div>
	</div>
</body>